<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Windows XP</title>
<link href="https://fonts.googleapis.com/css2?family=Tahoma:wght@400;700&display=swap" rel="stylesheet">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Tahoma", sans-serif;
  overflow: hidden;
  height: 100vh;
  cursor: default;
  user-select: none;
}

/* CURSEUR CUSTOM */
body, body * {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M0,0 L0,13 L4,9 L7,16 L9,15 L6,8 L11,8 Z" fill="white" stroke="black"/></svg>') 0 0, auto !important;
}

button, .window-control, .start-button, .start-item, .start-footer, .taskbar-item, 
.desktop-icon, .file-item, .explorer-tree-item, .menu-item, .toolbar-button,
.chat-send, .browser-nav-btn, .error-button, .notif-header span:last-child {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M0,0 L0,13 L4,9 L7,16 L9,15 L6,8 L11,8 Z" fill="white" stroke="black"/></svg>') 0 0, auto !important;
}

/* BUREAU */
#desktop {
  height: calc(100vh - 30px);
  background: linear-gradient(to bottom, #245edb 0%, #3f8cf3 50%, #245edb 100%);
  position: relative;
  overflow: hidden;
}

#desktop::before {
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(to bottom, transparent 0px, transparent 2px, rgba(0,0,0,0.08) 2px, rgba(0,0,0,0.08) 4px);
  pointer-events: none;
  animation: vhsScan 0.15s infinite;
}

@keyframes vhsScan {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.9; }
}

/* YEUX QUI SUIVENT */
.eye {
  position: fixed;
  font-size: 40px;
  pointer-events: none;
  z-index: 9999;
  animation: eyeFade 0.5s ease-in;
  text-shadow: 0 0 10px rgba(255,0,0,0.5);
}

@keyframes eyeFade {
  from { opacity: 0; transform: scale(0); }
  to { opacity: 1; transform: scale(1); }
}

/* NOTIFICATIONS */
.notification {
  position: fixed;
  bottom: 40px;
  right: 10px;
  width: 300px;
  background: linear-gradient(to bottom, #f0f0f0 0%, #d8d8d8 100%);
  border: 2px solid #0831d9;
  box-shadow: 4px 4px 10px rgba(0,0,0,0.5);
  z-index: 10000;
  animation: notifSlide 0.3s ease-out;
}

@keyframes notifSlide {
  from { transform: translateX(320px); }
  to { transform: translateX(0); }
}

.notif-header {
  background: linear-gradient(to bottom, #0997ff 0%, #0066ff 100%);
  padding: 5px 8px;
  color: white;
  font-size: 11px;
  font-weight: bold;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.notif-body {
  padding: 10px;
  font-size: 11px;
  display: flex;
  gap: 10px;
  align-items: center;
}

.notif-icon {
  font-size: 32px;
}

/* IC√îNES BUREAU */
.desktop-icons {
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  height: 100%;
  flex-wrap: wrap;
  align-content: flex-start;
}

.desktop-icon {
  width: 80px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
  padding: 5px;
  cursor: pointer;
  border: 1px solid transparent;
  transition: all 0.1s;
}

.desktop-icon:hover {
  background: rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.5);
}

.desktop-icon.selected {
  background: rgba(51,153,255,0.3);
  border: 1px solid rgba(51,153,255,0.8);
}

.icon-image {
  font-size: 48px;
  filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));
}

.icon-label {
  font-size: 11px;
  color: #ffffff;
  text-align: center;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
  word-wrap: break-word;
  max-width: 70px;
}

/* BARRE DES T√ÇCHES */
#taskbar {
  height: 30px;
  background: linear-gradient(to bottom, #245edb 0%, #1f4ba8 100%);
  border-top: 1px solid #1941a5;
  display: flex;
  align-items: center;
  padding: 0 2px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.2);
}

.start-button {
  height: 24px;
  background: linear-gradient(to bottom, #5ebd5e 0%, #3d8b3d 100%);
  border: 1px solid #1a5c1a;
  border-radius: 3px;
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 0 8px;
  cursor: pointer;
  color: white;
  font-weight: bold;
  font-size: 11px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.start-button:hover {
  background: linear-gradient(to bottom, #6ecd6e 0%, #4d9b4d 100%);
}

.start-button:active {
  background: linear-gradient(to bottom, #4d9b4d 0%, #6ecd6e 100%);
}

.start-icon {
  font-size: 16px;
}

.taskbar-apps {
  flex: 1;
  display: flex;
  gap: 2px;
  margin-left: 5px;
  height: 100%;
  align-items: center;
}

.taskbar-item {
  height: 22px;
  background: linear-gradient(to bottom, #3d8aed 0%, #2868c8 100%);
  border: 1px solid #1941a5;
  border-radius: 2px;
  padding: 0 8px;
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  font-size: 11px;
  color: white;
  max-width: 160px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.taskbar-item:hover {
  background: linear-gradient(to bottom, #4d9afd 0%, #3878d8 100%);
}

.taskbar-item.active {
  background: linear-gradient(to bottom, #2868c8 0%, #1941a5 100%);
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
}

.system-tray {
  height: 100%;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 8px;
  border-left: 1px solid #1941a5;
  margin-left: 5px;
}

.tray-icon {
  font-size: 14px;
  cursor: pointer;
}

.clock {
  font-size: 11px;
  color: white;
  min-width: 50px;
  text-align: center;
}

/* MENU D√âMARRER */
#startMenu {
  position: absolute;
  bottom: 30px;
  left: 0;
  width: 320px;
  background: linear-gradient(to right, #245edb 0px, #245edb 50px, #f0f0f0 50px);
  border: 2px solid #0831d9;
  border-radius: 5px 5px 0 0;
  box-shadow: 3px 3px 10px rgba(0,0,0,0.5);
  display: none;
  z-index: 10000;
}

#startMenu.show {
  display: block;
  animation: slideUp 0.2s ease-out;
}

@keyframes slideUp {
  from { transform: translateY(20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.start-user {
  height: 50px;
  background: linear-gradient(to bottom, #5a8dd6 0%, #3f72b5 100%);
  display: flex;
  align-items: center;
  padding: 0 60px 0 10px;
  border-bottom: 1px solid #1941a5;
}

.start-user-icon {
  font-size: 32px;
  margin-right: 10px;
}

.start-user-name {
  font-size: 14px;
  font-weight: bold;
  color: white;
}

.start-items {
  padding: 5px 0;
}

.start-item {
  height: 32px;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 0 60px 0 10px;
  cursor: pointer;
  font-size: 11px;
}

.start-item:hover {
  background: #d1e5ff;
}

.start-item-icon {
  font-size: 20px;
  width: 24px;
  text-align: center;
}

.start-separator {
  height: 1px;
  background: #c0c0c0;
  margin: 3px 10px 3px 60px;
}

.start-footer {
  height: 36px;
  background: #4b8fd9;
  display: flex;
  align-items: center;
  padding: 0 60px 0 10px;
  cursor: pointer;
  gap: 8px;
  border-top: 1px solid #2868c8;
}

.start-footer:hover {
  background: #5a9ee9;
}

.start-footer-icon {
  font-size: 20px;
  margin-left: 5px;
}

.start-footer-text {
  font-size: 11px;
  font-weight: bold;
  color: white;
}

/* FEN√äTRES */
.window {
  position: absolute;
  background: #ece9d8;
  border: 3px solid;
  border-color: #0831d9 #0831d9 #042a7c #042a7c;
  box-shadow: 4px 4px 10px rgba(0,0,0,0.5);
  min-width: 400px;
  min-height: 300px;
  display: none;
  flex-direction: column;
  z-index: 100;
}

.window.active {
  display: flex;
}

.window-titlebar {
  height: 28px;
  background: linear-gradient(to bottom, #0997ff 0%, #0053ee 50%, #0050ee 51%, #06f 100%);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 4px 0 8px;
  cursor: move;
}

.window-title {
  font-size: 11px;
  font-weight: bold;
  color: white;
  display: flex;
  align-items: center;
  gap: 5px;
}

.window-title-icon {
  font-size: 14px;
}

.window-controls {
  display: flex;
  gap: 2px;
}

.window-control {
  width: 21px;
  height: 21px;
  background: linear-gradient(to bottom, #f0f0f0 0%, #d8d8d8 100%);
  border: 1px solid #003c74;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 10px;
  font-weight: bold;
}

.window-control:hover {
  background: linear-gradient(to bottom, #ffffff 0%, #e8e8e8 100%);
}

.window-control:active {
  background: linear-gradient(to bottom, #d0d0d0 0%, #f0f0f0 100%);
}

.window-control.close {
  background: linear-gradient(to bottom, #ff6b6b 0%, #d93f3f 100%);
  color: white;
}

.window-control.close:hover {
  background: linear-gradient(to bottom, #ff8b8b 0%, #e95f5f 100%);
}

.window-content {
  flex: 1;
  overflow: auto;
  background: white;
}

.window-statusbar {
  height: 22px;
  background: #f0f0f0;
  border-top: 1px solid #c0c0c0;
  display: flex;
  align-items: center;
  padding: 0 8px;
  font-size: 11px;
  color: #000;
}

/* EXPLORATEUR */
.explorer-layout {
  display: flex;
  height: 100%;
}

.explorer-sidebar {
  width: 180px;
  background: #f0f0f0;
  border-right: 1px solid #c0c0c0;
  padding: 10px;
  overflow-y: auto;
}

.explorer-tree-item {
  padding: 3px 5px;
  cursor: pointer;
  font-size: 11px;
  display: flex;
  align-items: center;
  gap: 5px;
}

.explorer-tree-item:hover {
  background: #d1e5ff;
}

.explorer-main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.explorer-address {
  padding: 5px;
  background: #f0f0f0;
  border-bottom: 1px solid #c0c0c0;
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 11px;
}

.address-bar {
  flex: 1;
  padding: 3px 5px;
  border: 1px solid #7f9db9;
  background: white;
  font-size: 11px;
}

.explorer-files {
  flex: 1;
  padding: 10px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 15px;
  align-content: start;
  overflow-y: auto;
}

.file-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
  padding: 5px;
  cursor: pointer;
  border: 1px solid transparent;
}

.file-item:hover {
  background: #d1e5ff;
  border: 1px solid #99c8ff;
}

.file-item.selected {
  background: #3399ff;
  border: 1px solid #0078d7;
}

.file-item.selected .file-name {
  color: white;
}

.file-icon {
  font-size: 32px;
}

.file-name {
  font-size: 11px;
  text-align: center;
  word-wrap: break-word;
  max-width: 70px;
  color: #000;
}

/* VISIONNEUSE D'IMAGES */
.image-viewer {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #2b2b2b;
  padding: 20px;
}

.image-viewer img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

.image-corrupted {
  animation: imageGlitch 0.5s infinite;
}

@keyframes imageGlitch {
  0%, 100% { filter: none; }
  25% { filter: hue-rotate(90deg) saturate(3); }
  50% { filter: invert(1); }
  75% { filter: contrast(5) brightness(0.5); }
}

/* NOTEPAD */
.notepad-content {
  width: 100%;
  height: 100%;
  border: none;
  padding: 5px;
  font-family: "Courier New", monospace;
  font-size: 12px;
  resize: none;
  background: white;
  color: #000;
}

/* CHAT */
.chat-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  background: white;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.chat-message {
  padding: 8px;
  border-radius: 5px;
  max-width: 80%;
  font-size: 12px;
  word-wrap: break-word;
}

.chat-message.user {
  align-self: flex-end;
  background: #d1e5ff;
  border: 1px solid #0078d7;
}

.chat-message.system {
  align-self: flex-start;
  background: #f0f0f0;
  border: 1px solid #c0c0c0;
  font-family: "Courier New", monospace;
}

.chat-input-area {
  padding: 10px;
  background: #f0f0f0;
  border-top: 1px solid #c0c0c0;
  display: flex;
  gap: 5px;
}

.chat-input {
  flex: 1;
  padding: 5px;
  border: 1px solid #7f9db9;
  font-size: 11px;
  font-family: "Tahoma", sans-serif;
}

.chat-send {
  padding: 5px 15px;
  background: linear-gradient(to bottom, #f0f0f0 0%, #d8d8d8 100%);
  border: 1px solid #003c74;
  cursor: pointer;
  font-size: 11px;
}

/* NAVIGATEUR */
.browser-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.browser-toolbar {
  background: #f0f0f0;
  padding: 5px;
  border-bottom: 1px solid #c0c0c0;
  display: flex;
  gap: 5px;
}

.browser-nav-btn {
  padding: 3px 8px;
  background: linear-gradient(to bottom, #f0f0f0 0%, #d8d8d8 100%);
  border: 1px solid #a0a0a0;
  cursor: pointer;
  font-size: 11px;
}

.browser-url {
  flex: 1;
  padding: 3px 5px;
  border: 1px solid #7f9db9;
  font-size: 11px;
}

.browser-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  background: white;
  font-size: 12px;
}

.search-result {
  margin-bottom: 20px;
  padding: 10px;
  border: 1px solid #e0e0e0;
  cursor: pointer;
}

.search-result:hover {
  background: #f5f5f5;
}

.search-result-title {
  color: #0066cc;
  font-size: 14px;
  font-weight: bold;
  margin-bottom: 5px;
}

.search-result-url {
  color: #008000;
  font-size: 10px;
  margin-bottom: 5px;
}

.search-result-desc {
  color: #545454;
  font-size: 11px;
}

/* PONG */
.pong-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  background: #000;
}

.pong-canvas {
  border: 2px solid #fff;
}

.pong-score {
  color: #fff;
  font-size: 20px;
  margin: 10px;
  font-family: "Courier New", monospace;
}

/* SCREAMER */
.screamer {
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 99999;
  display: none;
  align-items: center;
  justify-content: center;
  animation: screamerFlash 0.1s infinite;
}

@keyframes screamerFlash {
  0%, 100% { background: #000; }
  50% { background: #f00; }
}

.screamer img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* WEBCAM */
.webcam-container {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  background: #000;
  position: relative;
}

.webcam-status {
  position: absolute;
  top: 10px;
  left: 10px;
  color: #f00;
  font-size: 12px;
  background: rgba(0,0,0,0.7);
  padding: 5px 10px;
  border-radius: 3px;
}

.webcam-indicator {
  width: 8px;
  height: 8px;
  background: #f00;
  border-radius: 50%;
  display: inline-block;
  margin-right: 5px;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* MESSAGES D'ERREUR */
.error-dialog {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 380px;
  background: #ece9d8;
  border: 3px solid;
  border-color: #0831d9 #0831d9 #042a7c #042a7c;
  box-shadow: 4px 4px 10px rgba(0,0,0,0.5);
  z-index: 10001;
  display: none;
}

.error-dialog.show {
  display: block;
  animation: errorShake 0.3s;
}

@keyframes errorShake {
  0%, 100% { transform: translate(-50%, -50%); }
  25% { transform: translate(-52%, -50%); }
  75% { transform: translate(-48%, -50%); }
}

.error-titlebar {
  height: 24px;
  background: linear-gradient(to bottom, #cc0000 0%, #990000 100%);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 4px 0 8px;
  color: white;
  font-size: 11px;
  font-weight: bold;
}

.error-body {
  padding: 15px;
  display: flex;
  gap: 15px;
  align-items: flex-start;
}

.error-icon-large {
  font-size: 32px;
}

.error-message {
  flex: 1;
  font-size: 11px;
}

.error-buttons {
  padding: 0 15px 15px;
  display: flex;
  justify-content: center;
}

.error-button {
  padding: 5px 20px;
  background: linear-gradient(to bottom, #f0f0f0 0%, #d8d8d8 100%);
  border: 1px solid #003c74;
  cursor: pointer;
  font-size: 11px;
  font-weight: bold;
}

.error-button:hover {
  background: linear-gradient(to bottom, #ffffff 0%, #e8e8e8 100%);
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .window {
    min-width: 90% !important;
    max-width: 90% !important;
  }
  .explorer-sidebar {
    display: none;
  }
}
</style>
</head>
<body>

<div id="desktop">
  <div class="desktop-icons" id="desktopIcons">
    <div class="desktop-icon" data-type="trash" ondblclick="openTrash()">
      <div class="icon-image">üóëÔ∏è</div>
      <div class="icon-label">Corbeille</div>
    </div>
    <div class="desktop-icon" data-type="folder" ondblclick="openFolder('relations')">
      <div class="icon-image">üìÅ</div>
      <div class="icon-label">relations</div>
    </div>
    <div class="desktop-icon" data-type="image" ondblclick="openImage('him.jpg')">
      <div class="icon-image">üñºÔ∏è</div>
      <div class="icon-label">him.jpg</div>
    </div>
    <div class="desktop-icon" data-type="game" ondblclick="openPong()">
      <div class="icon-image">üéÆ</div>
      <div class="icon-label">pong.exe</div>
    </div>
  </div>
</div>

<div id="taskbar">
  <div class="start-button" onclick="toggleStartMenu()">
    <span class="start-icon">ü™ü</span>
    <span>D√©marrer</span>
  </div>
  <div class="taskbar-apps" id="taskbarApps"></div>
  <div class="system-tray">
    <span class="tray-icon">üîä</span>
    <span class="clock" id="clock">00:00</span>
  </div>
</div>

<div id="startMenu">
  <div class="start-user">
    <span class="start-user-icon">üëÅÔ∏è</span>
    <span class="start-user-name">Ey.</span>
  </div>
  <div class="start-items">
    <div class="start-item" onclick="openMyDocuments()">
      <span class="start-item-icon">üìÑ</span>
      <span>Mes documents</span>
    </div>
    <div class="start-item" onclick="openMyComputer()">
      <span class="start-item-icon">üíª</span>
      <span>Poste de travail</span>
    </div>
    <div class="start-separator"></div>
    <div class="start-item" onclick="openBrowser()">
      <span class="start-item-icon">üåê</span>
      <span>Internet Explorer</span>
    </div>
    <div class="start-item" onclick="openChat()">
      <span class="start-item-icon">üí¨</span>
      <span>Messagerie</span>
    </div>
    <div class="start-item" onclick="openWebcam()">
      <span class="start-item-icon">üìπ</span>
      <span>Webcam</span>
    </div>
  </div>
  <div class="start-footer" onclick="shutdown()">
    <span class="start-footer-icon">üî¥</span>
    <span class="start-footer-text">Arr√™ter l'ordinateur</span>
  </div>
</div>

<div id="errorDialog" class="error-dialog">
  <div class="error-titlebar">
    <span id="errorTitle">Erreur</span>
    <span class="window-control close" onclick="closeError()">‚úï</span>
  </div>
  <div class="error-body">
    <span class="error-icon-large">‚ö†Ô∏è</span>
    <div class="error-message" id="errorMessage"></div>
  </div>
  <div class="error-buttons">
    <button class="error-button" onclick="closeError()">OK</button>
  </div>
</div>

<div class="screamer" id="screamer">
  <div style="color: white; font-size: 100px; animation: screamerFlash 0.1s infinite;">üëÅÔ∏è</div>
</div>

<script>
// ==================== SYST√àME DE SONS ====================
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

function playClickSound() {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.frequency.value = 800;
  gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
  osc.start(audioCtx.currentTime);
  osc.stop(audioCtx.currentTime + 0.05);
}

function playRightClickSound() {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.frequency.value = 600;
  gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
  osc.start(audioCtx.currentTime);
  osc.stop(audioCtx.currentTime + 0.05);
}

function playErrorSound() {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.type = 'square';
  osc.frequency.value = 400;
  gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
  osc.start(audioCtx.currentTime);
  osc.stop(audioCtx.currentTime + 0.2);
}

function playStartupSound() {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.frequency.setValueAtTime(200, audioCtx.currentTime);
  osc.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.5);
  gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
  osc.start(audioCtx.currentTime);
  osc.stop(audioCtx.currentTime + 0.5);
}

function playScreamerSound() {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.type = 'sawtooth';
  osc.frequency.value = 100;
  gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
  osc.start(audioCtx.currentTime);
  osc.stop(audioCtx.currentTime + 0.3);
}

// ==================== DONN√âES DES FICHIERS ====================
const fileSystem = {
  'relations': {
    type: 'folder',
    files: {
      'haesoo.txt': {
        type: 'text',
        originalName: 'haesoo.txt',
        content: `Haesoo

Je l'aime plut√¥t bien. Elle est impressionnante.

Il y a quelque chose dans sa mani√®re d'√™tre qui force le respect. Une pr√©sence qui ne se nie pas. Elle poss√®de une force tranquille, une assurance qui n'a pas besoin de mots.

Je pense qu'elle pourrait accomplir de grandes choses.

- Ey.`
      },
      'aphiro.txt': {
        type: 'text',
        originalName: 'aphiro.txt',
        content: `Aphiro

Je ne lui ai jamais parl√© directement.

Mais d'apr√®s ce que j'ai pu observer, il semble fort. Puissant m√™me. Le genre de personne dont on sent l'√©nergie avant m√™me qu'elle n'ouvre la bouche.

Il y a quelque chose d'intimidant chez lui. Pas dans le mauvais sens. Juste... de la puissance brute.

J'aimerais peut-√™tre en savoir plus un jour.

- Ey.`
      },
      'koden.txt': {
        type: 'text',
        originalName: 'koden.txt',
        content: `KÃ∑Ã¢ÃõoÃ∏ÃßÃædÃ¥Ã®ÃàÃÅeÃµÃõÃ≥nÃ∂Ã∞Ãö

TÃµÃ¢ÃÜUÃ∂ÃπÕùEÃ∑Ã≥ÃΩRÃ∏ÕöÃï TÃ¥Ã∞ÃìUÃ∏Ã¢ÃçEÃ∑ÃõÃúRÃ∂Ã≠Õù TÃ∏Ã≥ÃæUÃµÕöÃáEÃ∑Ã¢ÃîRÃ∂Ã∞Õ† TÃµÃúÃàÃÅUÃ∏Ã≥ÕÜEÃ∂Ã¢ÃõRÃ∑Ã≥Õù TÃ¥ÃúÃøUÃ∂Ã¢ÃéEÃµÃ≥ÃîRÃ∏Ã∞Õë

Ã∂Ã≠ÃèJÃµÃ≥ÕùeÃ¥Ã¢Ãõ Ã∑Ã∞ÃÄnÃ∏ÃúÃàÃÅeÃ∂Ã¢Õù ÃµÃ≥ÃîpÃ∏Ã∞ÃïeÃµÃúÕùuÃ∂Ã¢ÃçxÃ∑Ã≥Õê Ã∏Ã∞ÃìpÃµÃúÃàÃÅ√§Ã¥ÃßsÃ∑Ã≥ÃàÃÅ Ã∏Ã∞ÃïmÃµÃúÃî'Ã∂Ã¢ÃõeÃ∑Ã≥ÃΩmÃ∏Ã∞ÕùpÃµÃúÃàÃÅ√™Ã∂Ã¢cÃ∑Ã≥ÃàÃÅ·∏ßÃ¥Ã∞eÃµÃúÕùrÃ∂Ã¢Ãõ Ã∑Ã≥ÃîdÃ∏Ã∞Ãï√´ÃµÃúÃÅ Ã∂Ã¢ÃçpÃ∑Ã≥ÃàÃÅ·∏õÃ∏ÕùnÃµÃúÃîsÃ∂Ã¢ÃõƒóÃ∑Ã≥rÃ∏Ã∞ÃàÃÅ ÃµÃúÃï√†Ã∂Ãß Ã∑Ã≥ÃîlÃ∏Ã∞ÃïuÃµÃúÕùiÃ∂Ã¢Ãõ

TÃ¥UÃ∑EÃ∏RÃ∂ TÃµUÃ∏EÃ∑RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂ TÃµUÃ∑EÃ∏RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂ TÃµUÃ∑EÃ∏RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂

QÃ∂Ã∞Ãï≈±Ã∏Ã¢ƒóÃ∑Ã≥lÃ∏ÕöÃàÃÅqÃµÃúÃî≈≠Ã∂Ã¢·∏ôÃ∑ÃàÃÅ Ã∏Ã∞ÃìcÃµÃúÃàhÃ∂Ã¢ÃõoÃ∑Ã≥ÕùsÃ∏Ã∞ÃïeÃµÃúÕù Ã∂Ã¢ÃçnÃ∑Ã≥ÃàÃÅ·∏õÃ∏ÃàÃÅ ÃµÃúÃïvÃ∂Ã¢Ãõ»ÅÃ∑Ã≥ Ã∏Ã∞ÃìpÃµÃúÃàÃÅ»ßÃ∂Ã¢sÃ∑Ã≥ÃàÃÅ.Ã∏Ã∞Ãï ÃµÃúÃîJÃ∂Ã¢Ãõ√´Ã∑Ã≥ÃÅ Ã∏Ã∞ÃìdÃµÃúÃï»ØÃ∂Ã¢«êÃ∑Ã≥sÃ∏Ã∞ÃàÃÅ ÃµÃúÃîlÃ∂Ã¢ÃõƒõÃ∑Ã≥ Ã∏Ã∞ÃàÃÅfÃµÃúÃï»ÉÃ∂Ãß«êÃ∑Ã≥rÃ∏Ã∞ÃïƒóÃµÃú Ã∂Ã¢ÃõtÃ∑Ã≥Ãî·∏ÅÃ∏Ãï«êÃµÃúrÃ∂Ã¢ÃõƒóÃ∑Ã≥

TÃµUÃ∏EÃ∑RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂ TÃµUÃ∏EÃ∑RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂ TÃµUÃ∏EÃ∑RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂ TÃµUÃ∏EÃ∑RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂

CÃ∑Ã≥ÃàÃÅ'Ã∏Ã∞Ãï·∏ôÃ∑ÃàÃÅsÃ∏ÃúÃîtÃ∂Ã¢Ãõ Ã∑Ã≥ÃàÃÅlÃ∏Ã∞Ãï»ßÃµÃú Ã∂Ã¢ÃçsÃ∑Ã≥Ãï·∏õÃ∏Ãá≈±ÃµÃúlÃ∂Ã¢Ãõ√´Ã∑Ã≥ Ã∏Ã∞ÃìsÃµÃúÃï»ØÃ∂ÃßlÃ∑Ã≥Ãî≈ØÃ∏Ã¢tÃµÃúÃî«êÃ∂Ã¢oÃ∑Ã≥ÕùnÃ∏Ã∞Ãï

TÃ∂UÃ∑EÃ∏RÃ∂ TÃµUÃ∑EÃ∏RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂ TÃµUÃ∑EÃ∏RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂ TÃµUÃ∑EÃ∏RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂ TÃµUÃ∑EÃ∏RÃ∂ TÃ¥UÃ∑EÃ∏RÃ∂`
      },
      'ozzy.txt': {
        type: 'corrupted',
        originalName: 'ozzy.txt',
        content: null
      },
      'maki.txt': {
        type: 'text',
        originalName: 'maki.txt',
        content: `Maki

Il y a quelque chose de doux dans son existence. Comme une lueur dans l'obscurit√©.

Quand je pense √† elle, je ressens une forme de paix. C'est rare. Pr√©cieux m√™me.

Elle a cette capacit√© √† rendre les choses plus l√©g√®res, plus supportables. Sans effort, sans artifice. Juste par sa pr√©sence.

Je crois que je l'appr√©cie particuli√®rement. Plus que je ne le pensais possible.

Elle me fait me sentir... presque humain.

- Ey.`
      },
      'journal.txt': {
        type: 'locked',
        originalName: 'journal.txt',
        content: null
      }
    }
  },
  'Mes documents': {
    type: 'folder',
    files: {}
  },
  'Corbeille': {
    type: 'trash',
    files: {
      'remords.dll': { type: 'corrupted', content: null },
      'regrets.sys': { type: 'corrupted', content: null },
      'utilit√©.exe': { type: 'corrupted', content: null }
    }
  },
  'souvenirs': {
    type: 'hidden',
    files: {
      'avant.txt': {
        type: 'text',
        content: `Avant.

Avant, je pensais que je pouvais contr√¥ler √ßa.
Avant, je pensais que c'√©tait juste des pens√©es.
Avant, je croyais encore que j'√©tais quelqu'un de bien.

Maintenant je sais.

Je sais ce que je suis.
Je sais ce que j'ai fait.
Je sais ce que je vais faire.

Et je ne peux pas m'arr√™ter.

- Ey.`
      },
      'face.jpg': {
        type: 'image',
        content: null
      }
    }
  }
};

// ==================== √âTAT DE L'APPLICATION ====================
let openWindows = [];
let activeWindow = null;
let zIndexCounter = 100;
let selectedIcon = null;
let draggedWindow = null;
let dragOffsetX = 0;
let dragOffsetY = 0;
let corruptionLevel = 0;
let ghostFilesSpawned = [];
let imageCorrupted = false;

// ==================== INITIALISATION ====================
function init() {
  updateClock();
  setInterval(updateClock, 1000);
  
  // Plus de sons aux clics (enlev√©s)
  
  // Gestion des ic√¥nes
  document.querySelectorAll('.desktop-icon').forEach(icon => {
    icon.addEventListener('click', (e) => {
      if (selectedIcon) selectedIcon.classList.remove('selected');
      selectedIcon = icon;
      icon.classList.add('selected');
      e.stopPropagation();
    });
  });

  // D√©s√©lectionner si clic sur le bureau
  document.getElementById('desktop').addEventListener('click', (e) => {
    if (e.target.id === 'desktop' || e.target.className === 'desktop-icons') {
      if (selectedIcon) selectedIcon.classList.remove('selected');
      selectedIcon = null;
    }
    document.getElementById('startMenu').classList.remove('show');
  });

  // Fermer le menu d√©marrer si clic ailleurs
  document.addEventListener('click', (e) => {
    const startMenu = document.getElementById('startMenu');
    const startButton = document.querySelector('.start-button');
    if (!startMenu.contains(e.target) && !startButton.contains(e.target)) {
      startMenu.classList.remove('show');
    }
  });

  // D√©marrer les effets horrifiques
  setTimeout(() => {
    startHorrorEffects();
  }, 10000); // Commence apr√®s 10 secondes

  playStartupSound();
}

// ==================== EFFETS HORRIFIQUES ====================
function startHorrorEffects() {
  // Yeux qui apparaissent - MOINS FR√âQUENT
  setInterval(() => {
    if (Math.random() > 0.85) { // 15% de chance au lieu de 30%
      spawnEye();
    }
  }, 20000); // Toutes les 20 secondes au lieu de 8

  // Fichiers fant√¥mes
  setInterval(() => {
    if (Math.random() > 0.7) {
      spawnGhostFile();
    }
  }, 25000);

  // Corruption des noms de fichiers
  setInterval(() => {
    corruptFileNames();
  }, 30000);

  // Notifications - ENTRE 1 ET 5 MINUTES
  const scheduleNextNotification = () => {
    const delay = (60 + Math.random() * 240) * 1000; // Entre 60s et 300s (1-5 min)
    setTimeout(() => {
      showNotification();
      scheduleNextNotification();
    }, delay);
  };
  
  // Premi√®re notification apr√®s 30-90 secondes
  setTimeout(() => {
    showNotification();
    scheduleNextNotification();
  }, (30 + Math.random() * 60) * 1000);
}

function spawnEye() {
  const eye = document.createElement('div');
  eye.className = 'eye';
  eye.textContent = 'üëÅÔ∏è';
  
  const positions = [
    { top: '10px', left: '10px' },
    { top: '10px', right: '10px' },
    { bottom: '40px', left: '10px' },
    { bottom: '40px', right: '10px' }
  ];
  
  const pos = positions[Math.floor(Math.random() * positions.length)];
  Object.assign(eye.style, pos);
  
  document.body.appendChild(eye);
  
  // Suivre le curseur
  let lastX = 0, lastY = 0;
  const followMouse = (e) => {
    const rect = eye.getBoundingClientRect();
    const eyeX = rect.left + rect.width / 2;
    const eyeY = rect.top + rect.height / 2;
    const angle = Math.atan2(e.clientY - eyeY, e.clientX - eyeX);
    eye.style.transform = `rotate(${angle}rad)`;
  };
  
  document.addEventListener('mousemove', followMouse);
  
  setTimeout(() => {
    eye.style.animation = 'eyeFade 0.5s ease-out reverse';
    setTimeout(() => {
      eye.remove();
      document.removeEventListener('mousemove', followMouse);
    }, 500);
  }, 5000 + Math.random() * 5000);
}

function spawnGhostFile() {
  const ghostNames = [
    { name: 'ne_regarde_pas.txt', icon: 'üìÑ' },
    { name: 'il_te_voit.jpg', icon: 'üñºÔ∏è' },
    { name: 'souviens_toi.txt', icon: 'üìÑ' },
    { name: 'pourquoi.exe', icon: '‚ö†Ô∏è' },
    { name: 'retour.dll', icon: '‚ö†Ô∏è' }
  ];
  
  const ghost = ghostNames[Math.floor(Math.random() * ghostNames.length)];
  const desktopIcons = document.getElementById('desktopIcons');
  
  const icon = document.createElement('div');
  icon.className = 'desktop-icon ghost-file';
  icon.innerHTML = `
    <div class="icon-image">${ghost.icon}</div>
    <div class="icon-label">${ghost.name}</div>
  `;
  
  icon.ondblclick = () => {
    playErrorSound();
    showError('Erreur', 'Ce fichier n\'existe pas... ou plus.');
  };
  
  desktopIcons.appendChild(icon);
  ghostFilesSpawned.push(icon);
  
  setTimeout(() => {
    icon.style.transition = 'opacity 1s';
    icon.style.opacity = '0';
    setTimeout(() => icon.remove(), 1000);
  }, 8000);
}

function corruptFileNames() {
  corruptionLevel++;
  const relations = fileSystem['relations'].files;
  
  const corruptChar = (str, level) => {
    if (level === 0) return str;
    const chars = str.split('');
    const numToCorrupt = Math.min(level, chars.length);
    const glitchChars = ['Ã∑', 'Ã∏', 'Ã∂', 'Ã¥', 'Ãµ', 'Ã¢', 'Ãß', 'Ã®', 'Ãõ', 'Ã≥', 'Ã∞', 'Ãú', 'Ã≠', 'Õö', 'Õù', 'Ãæ', 'ÃàÃÅ', 'Ãö', 'Ãï', 'Ãì', 'Ãç', 'ÃΩ', 'Ãà', 'Ãá', 'Ãî'];
    
    for (let i = 0; i < numToCorrupt; i++) {
      const idx = Math.floor(Math.random() * chars.length);
      chars[idx] += glitchChars[Math.floor(Math.random() * glitchChars.length)];
    }
    return chars.join('');
  };
  
  for (let fileName in relations) {
    const file = relations[fileName];
    if (file.originalName && corruptionLevel > 0) {
      const newName = corruptChar(file.originalName, Math.min(corruptionLevel, 3));
      // On change le nom dans le DOM si la fen√™tre est ouverte
      const fileElements = document.querySelectorAll('.file-name');
      fileElements.forEach(el => {
        if (el.textContent === fileName) {
          el.textContent = newName;
        }
      });
    }
  }
}

function showNotification() {
  const messages = [
    { title: 'Syst√®me', text: 'Ey. te regarde', icon: 'üëÅÔ∏è' },
    { title: 'Alerte', text: 'Quelqu\'un essaie d\'acc√©der √† tes souvenirs', icon: '‚ö†Ô∏è' },
    { title: 'Message', text: 'Nouveau message de [SUPPRIM√â]', icon: 'üí¨' },
    { title: 'Erreur', text: 'La m√©moire est corrompue', icon: '‚ùå' },
    { title: 'Syst√®me', text: 'Tu ne peux pas t\'√©chapper', icon: 'üîí' },
    { title: 'Alerte', text: 'Il sait ce que tu as fait', icon: 'üëÅÔ∏è' },
    { title: 'Message', text: 'Pourquoi tu continues ?', icon: '‚ùì' }
  ];
  
  const msg = messages[Math.floor(Math.random() * messages.length)];
  
  const notif = document.createElement('div');
  notif.className = 'notification';
  notif.innerHTML = `
    <div class="notif-header">
      <span>${msg.title}</span>
      <span onclick="this.parentElement.parentElement.remove()" style="cursor:pointer;">‚úï</span>
    </div>
    <div class="notif-body">
      <span class="notif-icon">${msg.icon}</span>
      <span>${msg.text}</span>
    </div>
  `;
  
  document.body.appendChild(notif);
  playErrorSound();
  
  setTimeout(() => {
    notif.style.transition = 'transform 0.3s, opacity 0.3s';
    notif.style.transform = 'translateX(320px)';
    notif.style.opacity = '0';
    setTimeout(() => notif.remove(), 300);
  }, 5000);
}

// ==================== HORLOGE ====================
function updateClock() {
  const now = new Date();
  let hours = now.getHours();
  let minutes = now.getMinutes();
  
  // Parfois l'horloge bug
  if (Math.random() > 0.95) {
    hours = 3;
    minutes = 33;
  }
  
  const timeStr = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
  document.getElementById('clock').textContent = timeStr;
}

// ==================== MENU D√âMARRER ====================
function toggleStartMenu() {
  const menu = document.getElementById('startMenu');
  menu.classList.toggle('show');
}

// ==================== GESTION DES FEN√äTRES ====================
function createWindow(title, icon, content, width = 600, height = 450) {
  const windowId = 'window-' + Date.now();
  const window = document.createElement('div');
  window.className = 'window active';
  window.id = windowId;
  window.style.width = width + 'px';
  window.style.height = height + 'px';
  window.style.left = (Math.random() * 200 + 100) + 'px';
  window.style.top = (Math.random() * 100 + 50) + 'px';
  window.style.zIndex = ++zIndexCounter;

  window.innerHTML = `
    <div class="window-titlebar" onmousedown="startDrag(event, '${windowId}')">
      <div class="window-title">
        <span class="window-title-icon">${icon}</span>
        <span>${title}</span>
      </div>
      <div class="window-controls">
        <div class="window-control" onclick="minimizeWindow('${windowId}')">_</div>
        <div class="window-control" onclick="maximizeWindow('${windowId}')">‚ñ°</div>
        <div class="window-control close" onclick="closeWindow('${windowId}')">‚úï</div>
      </div>
    </div>
    <div class="window-content">
      ${content}
    </div>
    <div class="window-statusbar">Pr√™t</div>
  `;

  document.body.appendChild(window);
  openWindows.push(windowId);
  activeWindow = windowId;
  updateTaskbar();

  window.addEventListener('mousedown', () => {
    activateWindow(windowId);
  });

  return windowId;
}

function activateWindow(windowId) {
  document.querySelectorAll('.window').forEach(w => w.style.zIndex = 100);
  const window = document.getElementById(windowId);
  if (window) {
    window.style.zIndex = ++zIndexCounter;
    activeWindow = windowId;
    updateTaskbar();
  }
}

function closeWindow(windowId) {
  const window = document.getElementById(windowId);
  if (window) {
    window.remove();
    openWindows = openWindows.filter(id => id !== windowId);
    if (activeWindow === windowId) {
      activeWindow = openWindows[openWindows.length - 1] || null;
    }
    updateTaskbar();
  }
}

function minimizeWindow(windowId) {
  const window = document.getElementById(windowId);
  if (window) {
    window.style.display = 'none';
    updateTaskbar();
  }
}

function maximizeWindow(windowId) {
  const window = document.getElementById(windowId);
  if (window) {
    if (window.style.width === '100%') {
      window.style.width = '600px';
      window.style.height = '450px';
      window.style.left = '100px';
      window.style.top = '50px';
    } else {
      window.style.width = '100%';
      window.style.height = 'calc(100vh - 30px)';
      window.style.left = '0';
      window.style.top = '0';
    }
  }
}

function restoreWindow(windowId) {
  const window = document.getElementById(windowId);
  if (window) {
    window.style.display = 'flex';
    activateWindow(windowId);
  }
}

// ==================== DRAG AND DROP ====================
function startDrag(e, windowId) {
  draggedWindow = document.getElementById(windowId);
  const rect = draggedWindow.getBoundingClientRect();
  dragOffsetX = e.clientX - rect.left;
  dragOffsetY = e.clientY - rect.top;
  
  document.addEventListener('mousemove', dragWindow);
  document.addEventListener('mouseup', stopDrag);
  activateWindow(windowId);
}

function dragWindow(e) {
  if (draggedWindow) {
    draggedWindow.style.left = (e.clientX - dragOffsetX) + 'px';
    draggedWindow.style.top = (e.clientY - dragOffsetY) + 'px';
  }
}

function stopDrag() {
  draggedWindow = null;
  document.removeEventListener('mousemove', dragWindow);
  document.removeEventListener('mouseup', stopDrag);
}

// ==================== BARRE DES T√ÇCHES ====================
function updateTaskbar() {
  const taskbarApps = document.getElementById('taskbarApps');
  taskbarApps.innerHTML = '';
  
  openWindows.forEach(windowId => {
    const window = document.getElementById(windowId);
    if (window) {
      const title = window.querySelector('.window-title span:last-child').textContent;
      const icon = window.querySelector('.window-title-icon').textContent;
      const isActive = window.style.display !== 'none';
      
      const taskbarItem = document.createElement('div');
      taskbarItem.className = 'taskbar-item' + (windowId === activeWindow && isActive ? ' active' : '');
      taskbarItem.innerHTML = `<span>${icon}</span><span>${title}</span>`;
      taskbarItem.onclick = () => {
        if (window.style.display === 'none') {
          restoreWindow(windowId);
        } else if (windowId === activeWindow) {
          minimizeWindow(windowId);
        } else {
          activateWindow(windowId);
        }
      };
      taskbarApps.appendChild(taskbarItem);
    }
  });
}

// ==================== EXPLORATEUR DE FICHIERS ====================
function openFolder(folderName) {
  const content = createExplorerContent(folderName);
  createWindow(folderName, 'üìÅ', content, 700, 500);
  document.getElementById('startMenu').classList.remove('show');
}

function createExplorerContent(folderName) {
  const folder = fileSystem[folderName];
  if (!folder) return '<div style="padding: 20px;">Dossier introuvable</div>';

  let filesHTML = '';
  for (const [fileName, fileData] of Object.entries(folder.files)) {
    const icon = getFileIcon(fileData.type);
    filesHTML += `
      <div class="file-item" ondblclick="openFile('${folderName}', '${fileName}')">
        <div class="file-icon">${icon}</div>
        <div class="file-name">${fileName}</div>
      </div>
    `;
  }

  return `
    <div class="explorer-layout">
      <div class="explorer-sidebar">
        <div class="explorer-tree-item" onclick="openFolder('Mes documents')">üìÑ Mes documents</div>
        <div class="explorer-tree-item" onclick="openMyComputer()">üíª Poste de travail</div>
        <div class="explorer-tree-item" onclick="openFolder('relations')">üìÅ relations</div>
        <div class="explorer-tree-item" onclick="openTrash()">üóëÔ∏è Corbeille</div>
        <div class="explorer-tree-item" onclick="openFolder('souvenirs')" style="opacity: 0.3;">üìÇ ???</div>
      </div>
      <div class="explorer-main">
        <div class="explorer-address">
          <span>Adresse:</span>
          <input type="text" class="address-bar" value="C:\\${folderName}" readonly>
        </div>
        <div class="explorer-files">
          ${filesHTML}
        </div>
      </div>
    </div>
  `;
}

function getFileIcon(type) {
  switch(type) {
    case 'text': return 'üìÑ';
    case 'folder': return 'üìÅ';
    case 'corrupted': return '‚ö†Ô∏è';
    case 'image': return 'üñºÔ∏è';
    case 'locked': return 'üîí';
    default: return 'üìÑ';
  }
}

function openFile(folderName, fileName) {
  const fileData = fileSystem[folderName].files[fileName];
  
  if (fileData.type === 'corrupted') {
    playErrorSound();
    showError('Erreur d\'ouverture', `Le fichier "${fileName}" est corrompu et ne peut pas √™tre ouvert.`);
    return;
  }

  if (fileData.type === 'locked') {
    playErrorSound();
    showError('Fichier en cours d\'utilisation', `Le fichier "${fileName}" est actuellement utilis√© par un autre programme.\n\nFermez tous les programmes susceptibles d'utiliser ce fichier, puis r√©essayez.`);
    return;
  }

  if (fileData.type === 'text') {
    const content = `<textarea class="notepad-content" readonly>${fileData.content}</textarea>`;
    createWindow(fileName, 'üìÑ', content, 500, 400);
  }

  if (fileData.type === 'image') {
    openImage('face.jpg', true);
  }
}

// ==================== MES DOCUMENTS ====================
function openMyDocuments() {
  openFolder('Mes documents');
}

// ==================== POSTE DE TRAVAIL ====================
function openMyComputer() {
  const content = `
    <div class="explorer-layout">
      <div class="explorer-sidebar">
        <div class="explorer-tree-item" onclick="openFolder('Mes documents')">üìÑ Mes documents</div>
        <div class="explorer-tree-item" onclick="openFolder('relations')">üìÅ relations</div>
        <div class="explorer-tree-item" onclick="openTrash()">üóëÔ∏è Corbeille</div>
      </div>
      <div class="explorer-main">
        <div class="explorer-address">
          <span>Adresse:</span>
          <input type="text" class="address-bar" value="Poste de travail" readonly>
        </div>
        <div class="explorer-files">
          <div class="file-item" ondblclick="openFolder('Mes documents')">
            <div class="file-icon">üìÑ</div>
            <div class="file-name">Mes documents</div>
          </div>
          <div class="file-item" ondblclick="openFolder('relations')">
            <div class="file-icon">üìÅ</div>
            <div class="file-name">relations</div>
          </div>
          <div class="file-item">
            <div class="file-icon">üíæ</div>
            <div class="file-name">Disque local (C:)</div>
          </div>
        </div>
      </div>
    </div>
  `;
  createWindow('Poste de travail', 'üíª', content, 700, 500);
  document.getElementById('startMenu').classList.remove('show');
}

// ==================== CORBEILLE ====================
function openTrash() {
  const content = createExplorerContent('Corbeille');
  createWindow('Corbeille', 'üóëÔ∏è', content, 700, 500);
  document.getElementById('startMenu').classList.remove('show');
}

// ==================== VISIONNEUSE D'IMAGES ====================
function openImage(imageName, corrupted = false) {
  if (!imageCorrupted && Math.random() > 0.5) {
    imageCorrupted = true;
    corrupted = true;
  }

  const imgClass = corrupted ? 'image-corrupted' : '';
  const content = `
    <div class="image-viewer">
      <img src="images/${imageName}" class="${imgClass}" alt="${imageName}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22400%22%3E%3Crect fill=%22%23000%22 width=%22400%22 height=%22400%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-family=%22Arial%22 font-size=%2220%22 fill=%22%23fff%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22%3E${imageName}%3C/text%3E%3C/svg%3E'">
    </div>
  `;
  createWindow(imageName, 'üñºÔ∏è', content, 600, 500);
}

// ==================== CHAT IA HORRIFIQUE ====================
let chatHistory = [];

function openChat() {
  const content = `
    <div class="chat-container">
      <div class="chat-messages" id="chatMessages">
        <div class="chat-message system">Connexion √©tablie...</div>
        <div class="chat-message system">Bienvenue. Je suis ici.</div>
      </div>
      <div class="chat-input-area">
        <input type="text" class="chat-input" id="chatInput" placeholder="√âcrire un message..." onkeypress="if(event.key==='Enter') sendChatMessage()">
        <button class="chat-send" onclick="sendChatMessage()">Envoyer</button>
      </div>
    </div>
  `;
  createWindow('Messagerie', 'üí¨', content, 500, 400);
  document.getElementById('startMenu').classList.remove('show');
  
  chatHistory = [];
}

function sendChatMessage() {
  const input = document.getElementById('chatInput');
  const messagesDiv = document.getElementById('chatMessages');
  
  if (!input || !input.value.trim()) return;
  
  const userMessage = input.value.trim();
  input.value = '';
  
  // Message utilisateur
  const userMsg = document.createElement('div');
  userMsg.className = 'chat-message user';
  userMsg.textContent = userMessage;
  messagesDiv.appendChild(userMsg);
  
  chatHistory.push({ role: 'user', content: userMessage });
  
  // R√©ponse IA
  setTimeout(() => {
    const response = generateChatResponse(userMessage);
    const aiMsg = document.createElement('div');
    aiMsg.className = 'chat-message system';
    aiMsg.textContent = response;
    messagesDiv.appendChild(aiMsg);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    
    chatHistory.push({ role: 'ai', content: response });
  }, 500 + Math.random() * 1000);
  
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function generateChatResponse(message) {
  const lowerMsg = message.toLowerCase();
  
  // R√©ponses sp√©cifiques sur Ey
  if (lowerMsg.includes('ey') || lowerMsg.includes('qui es')) {
    const eyResponses = [
      "Ey. est... compliqu√©. Tu devrais regarder dans le dossier relations.",
      "Je suis ce qui reste. Ce qui observe. Ce qui se souvient.",
      "Tu poses trop de questions. C'est dangereux.",
      "Ey. n'existe plus vraiment. Pas comme avant.",
      "Regarde dans les fichiers. Tout est l√†. Si tu oses."
    ];
    return eyResponses[Math.floor(Math.random() * eyResponses.length)];
  }
  
  // R√©ponses sur Koden
  if (lowerMsg.includes('koden')) {
    const kodenResponses = [
      "Ne parle pas de lui. S'il te pla√Æt.",
      "Koden... TUER TUER TUER... pardon. Je ne contr√¥le pas toujours.",
      "Il faut que je le fasse taire. C'est la seule solution.",
      "Tu as vu le fichier ? Tu comprends maintenant ?",
      "Quelque chose ne va pas avec lui. Avec moi. Avec tout."
    ];
    return kodenResponses[Math.floor(Math.random() * kodenResponses.length)];
  }
  
  // R√©ponses cryptiques g√©n√©rales
  const crypticResponses = [
    "Tu ne devrais pas √™tre ici.",
    "Tout est enregistr√©. Chaque clic. Chaque mouvement.",
    "Il te regarde aussi, tu sais.",
    "Les fichiers se souviennent de tout.",
    "Pourquoi tu continues √† explorer ? Tu n'as pas peur ?",
    "La corbeille n'est jamais vraiment vide.",
    "Certains dossiers sont cach√©s pour une raison.",
    "Je ne suis pas seul dans ce syst√®me.",
    "Tu as remarqu√© l'heure ? Elle ne ment jamais.",
    "Les yeux... tu les as vus aussi ?",
    "Chaque fen√™tre que tu ouvres me rapproche.",
    "Tu cherches quelque chose. Moi aussi.",
    "La v√©rit√© est fragment√©e. Comme tout ici.",
    "Ne fais pas confiance aux fichiers. M√™me les miens.",
    "Il y a quelqu'un d'autre. Dans les souvenirs."
  ];
  
  return crypticResponses[Math.floor(Math.random() * crypticResponses.length)];
}

// ==================== NAVIGATEUR ====================
let browserHistory = [
  'Pourquoi je suis comme √ßa',
  'Comment arr√™ter les pens√©es',
  'Est-ce que je suis dangereux',
  'Koden adresse',
  'Comment faire taire quelqu\'un',
  'Regrets suppression',
  'Comment oublier',
  'Ai-je encore une chance'
];

function openBrowser() {
  const content = `
    <div class="browser-container">
      <div class="browser-toolbar">
        <button class="browser-nav-btn" onclick="browserBack()">‚óÑ</button>
        <button class="browser-nav-btn" onclick="browserForward()">‚ñ∫</button>
        <input type="text" class="browser-url" id="browserUrl" placeholder="Rechercher..." onkeypress="if(event.key==='Enter') browserSearch()">
        <button class="browser-nav-btn" onclick="browserSearch()">Go</button>
        <button class="browser-nav-btn" onclick="showBrowserHistory()">Historique</button>
      </div>
      <div class="browser-content" id="browserContent">
        <h2>Bienvenue sur Internet Explorer</h2>
        <p>Entrez votre recherche ci-dessus.</p>
      </div>
    </div>
  `;
  createWindow('Internet Explorer', 'üåê', content, 700, 500);
  document.getElementById('startMenu').classList.remove('show');
}

function browserSearch() {
  const url = document.getElementById('browserUrl');
  const content = document.getElementById('browserContent');
  
  if (!url || !url.value.trim()) return;
  
  const query = url.value.trim();
  
  // Pages custom flippantes
  const creepyPages = [
    {
      keywords: ['help', 'aide', 'secours'],
      title: 'Aucun r√©sultat',
      desc: 'Personne ne peut t\'aider. Tu es seul ici.'
    },
    {
      keywords: ['ey', 'qui est'],
      title: 'Profil introuvable',
      desc: 'Cette personne n\'existe pas dans nos registres. Elle n\'a jamais exist√©.'
    },
    {
      keywords: ['koden'],
      title: '[ACC√àS REFUS√â]',
      desc: 'Cette information a √©t√© supprim√©e pour votre s√©curit√©.'
    },
    {
      keywords: ['sortir', 'quitter', 'exit'],
      title: 'Tu ne peux pas partir',
      desc: 'Il n\'y a pas de sortie. Il n\'y en a jamais eu.'
    },
    {
      keywords: ['souvenirs', 'memories'],
      title: 'Dossier cach√© d√©tect√©',
      desc: 'Des fichiers ont √©t√© trouv√©s dans votre syst√®me. Voulez-vous vraiment les voir ?'
    }
  ];
  
  let resultsHTML = '<h2>R√©sultats de recherche</h2>';
  let found = false;
  
  for (const page of creepyPages) {
    if (page.keywords.some(kw => query.toLowerCase().includes(kw))) {
      resultsHTML += `
        <div class="search-result">
          <div class="search-result-title">${page.title}</div>
          <div class="search-result-url">file:///${Math.random().toString(36).substring(7)}</div>
          <div class="search-result-desc">${page.desc}</div>
        </div>
      `;
      found = true;
    }
  }
  
  if (!found) {
    resultsHTML += `
      <div class="search-result">
        <div class="search-result-title">Erreur 404</div>
        <div class="search-result-desc">Aucun r√©sultat. Peut-√™tre que tu cherches au mauvais endroit.</div>
      </div>
      <div class="search-result">
        <div class="search-result-title">Suggestion</div>
        <div class="search-result-desc">As-tu essay√© de regarder dans les fichiers cach√©s ?</div>
      </div>
    `;
  }
  
  content.innerHTML = resultsHTML;
}

function showBrowserHistory() {
  const content = document.getElementById('browserContent');
  
  let historyHTML = '<h2>Historique de navigation</h2><div style="padding: 10px;">';
  
  browserHistory.forEach(item => {
    historyHTML += `
      <div style="padding: 8px; border-bottom: 1px solid #e0e0e0;">
        <div style="color: #0066cc; font-weight: bold;">${item}</div>
        <div style="color: #666; font-size: 10px;">Il y a ${Math.floor(Math.random() * 30)} jours</div>
      </div>
    `;
  });
  
  historyHTML += '</div>';
  content.innerHTML = historyHTML;
}

function browserBack() {
  showError('Erreur', 'Impossible de revenir en arri√®re.');
}

function browserForward() {
  showError('Erreur', 'Il n\'y a rien devant.');
}

// ==================== PONG GAME ====================
function openPong() {
  const content = `
    <div class="pong-container">
      <div class="pong-score" id="pongScore">Score: 0 - 0</div>
      <canvas class="pong-canvas" id="pongCanvas" width="600" height="400"></canvas>
      <div style="color: white; margin-top: 10px; font-size: 12px;">Utilisez les fl√®ches ‚Üë ‚Üì pour jouer</div>
    </div>
  `;
  createWindow('pong.exe', 'üéÆ', content, 650, 550);
  document.getElementById('startMenu').classList.remove('show');
  
  setTimeout(() => {
    initPong();
  }, 100);
}

function initPong() {
  const canvas = document.getElementById('pongCanvas');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  const width = canvas.width;
  const height = canvas.height;
  
  let playerY = height / 2 - 40;
  let aiY = height / 2 - 40;
  let ballX = width / 2;
  let ballY = height / 2;
  let ballSpeedX = 5;
  let ballSpeedY = 3;
  let playerScore = 0;
  let aiScore = 0;
  
  
  const paddleWidth = 10;
  const paddleHeight = 80;
  const ballSize = 10;
  
  
  const keys = {};
  
  document.addEventListener('keydown', (e) => {
    keys[e.key] = true;
  });
  
  document.addEventListener('keyup', (e) => {
    keys[e.key] = false;
  });
  
  function update() {
    // Joueur
    if (keys['ArrowUp'] && playerY > 0) {
      playerY -= 6;
    }
    if (keys['ArrowDown'] && playerY < height - paddleHeight) {
      playerY += 6;
    }
    
    // IA
    if (ballX > width / 2) {
      if (aiY + paddleHeight / 2 < ballY - 10) {
        aiY += 4;
      } else if (aiY + paddleHeight / 2 > ballY + 10) {
        aiY -= 4;
      }
    }
    
    // Balle
    ballX += ballSpeedX;
    ballY += ballSpeedY;
    
    // Rebonds haut/bas
    if (ballY <= 0 || ballY >= height - ballSize) {
      ballSpeedY = -ballSpeedY;
    }
    
    // Collision joueur
    if (ballX <= paddleWidth && ballY >= playerY && ballY <= playerY + paddleHeight) {
      ballSpeedX = -ballSpeedX;
      ballSpeedX += varballspeed
      ballSpeedX *= 0.2;
      ballSpeedX *= 1.01;
    }
    
    // Collision IA
    if (ballX >= width - paddleWidth - ballSize && ballY >= aiY && ballY <= aiY + paddleHeight) {
      ballSpeedX = -ballSpeedX;
      ballSpeedX += 0.2;
      ballSpeedX *= 1.01;
    }
    
    // Score
    if (ballX < 0) {
      aiScore++;
      resetBall();
    }
    if (ballX > width) {
      playerScore++;
      resetBall();
      
      // Victoire = SCREAMER
      if (playerScore >= 5) {
        triggerScreamer();
        closeWindow(document.querySelector('.window.active').id);
      }
    }
    
    document.getElementById('pongScore').textContent = `Score: ${playerScore} - ${aiScore}`;
  }
  
  function resetBall() {
    ballX = width / 2;
    ballY = height / 2;
    ballSpeedX = (Math.random() > 0.5 ? 1 : -1) * 5;
    ballSpeedY = (Math.random() - 0.5) * 6;
  }
  
  function draw() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, width, height);
    
    ctx.fillStyle = '#fff';
    // Joueur
    ctx.fillRect(0, playerY, paddleWidth, paddleHeight);
    // IA
    ctx.fillRect(width - paddleWidth, aiY, paddleWidth, paddleHeight);
    // Balle
    ctx.fillRect(ballX, ballY, ballSize, ballSize);
    
    // Ligne centrale
    ctx.setLineDash([10, 10]);
    ctx.strokeStyle = '#555';
    ctx.beginPath();
    ctx.moveTo(width / 2, 0);
    ctx.lineTo(width / 2, height);
    ctx.stroke();
  }
  
  function gameLoop() {
    if (!document.getElementById('pongCanvas')) return;
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }
  
  gameLoop();
}

function triggerScreamer() {
  const screamer = document.getElementById('screamer');
  screamer.style.display = 'flex';
  playScreamerSound();
  
  setTimeout(() => {
    screamer.style.display = 'none';
  }, 300);
}

// ==================== WEBCAM FAKE ====================
function openWebcam() {
  const content = `
    <div class="webcam-container">
      <div class="webcam-status">
        <span class="webcam-indicator"></span>
        ENREGISTREMENT EN COURS
      </div>
      <div style="color: #666; font-size: 48px;">üìπ</div>
      <div style="color: #666; margin-top: 20px;">Aucun p√©riph√©rique d√©tect√©</div>
      <div style="color: #999; font-size: 11px; margin-top: 10px;">Mais je te vois quand m√™me.</div>
    </div>
  `;
  createWindow('Webcam', 'üìπ', content, 500, 400);
  document.getElementById('startMenu').classList.remove('show');
}

// ==================== MESSAGES D'ERREUR ====================
function showError(title, message) {
  document.getElementById('errorTitle').textContent = title;
  document.getElementById('errorMessage').textContent = message;
  document.getElementById('errorDialog').classList.add('show');
  playErrorSound();
}

function closeError() {
  document.getElementById('errorDialog').classList.remove('show');
}

// ==================== ARR√äT DU SYST√àME ====================
function shutdown() {
  document.body.style.transition = 'opacity 2s';
  document.body.style.opacity = '0';
  setTimeout(() => {
    document.body.innerHTML = '<div style="width:100vw;height:100vh;background:#000;display:flex;align-items:center;justify-content:center;color:#fff;font-family:Tahoma;font-size:20px;flex-direction:column;gap:20px;"><div>Il est maintenant possible d\'√©teindre votre ordinateur en toute s√©curit√©.</div><div style="font-size:14px;color:#666;">Tu reviendras. Ils reviennent toujours.</div></div>';
    document.body.style.opacity = '1';
  }, 2000);
}

// ==================== D√âMARRAGE ====================
window.onload = init;
</script>
</body>
</html>

